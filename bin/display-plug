#!/bin/bash

set -o pipefail

export HOME=/home/ed
export DISPLAY=:0.0
export XAUTHORITY=$HOME/.Xauthority

function connect() {
	echo "connect"
	sed -i 's/^Xft.dpi\: [0-9]*$/Xft.dpi: 160/g' $HOME/.Xresources
	sed -i 's/^Xcursor.size\: [0-9]*$/Xcursor.size: 24/g' $HOME/.Xresources
	xrdb -merge $HOME/.Xresources
	xrandr --output $1 --auto --primary --output eDP-1 --off
}

function disconnect() {
	echo "disconnect"
	sed -i 's/^Xft.dpi\: [0-9]*$/Xft.dpi: 224/g' $HOME/.Xresources
	sed -i 's/^Xcursor.size\: [0-9]*$/Xcursor.size: 48/g' $HOME/.Xresources
	xrdb -merge $HOME/.Xresources
	xrandr --output eDP-1 -auto --primary --output $1 --off
}

main() {
	# list of all different HDMI ports on docking stations etc.
	for disp in "DP-1" "HDMI-1"; do
		if xrandr --query | grep -e "^$disp connected" &> /dev/null; then
			connect $disp
			break
		else
			disconnect $disp
		fi
	done
}

# start it forked so the monitor is active
# this is needed because udev activates the monitor
# AFTER this script returns
main &
